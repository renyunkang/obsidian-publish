<!doctype html><html lang=en><head><script async defer data-website-id=08a754c4-6690-46d7-bb80-8ff93cfa232f src=https://umami.oldwinter.top/umami.js></script><meta charset=utf-8><meta name=description content="ipvs 相关内核文档：
  IPvs-sysctl — The Linux Kernel documentation  1. 参数 am_droprate 1 2 3  am_droprate - INTEGER default 10 It sets the always mode drop rate, which is used in the mode 3 of the drop_rate defense."><title>ipvs 相关的内核参数</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://www.ryken.cloud//icon.png><link href=https://www.ryken.cloud/styles.b3e1e36b0403ac565c9392b3e23ef3b6.min.css rel=stylesheet><link href=https://www.ryken.cloud/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://www.ryken.cloud/js/darkmode.66c3ed4615b59e04fa897375e67b0fe2.min.js></script>
<script src=https://www.ryken.cloud/js/util.9825137f5e7825e8553c68ce39ac9e44.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://www.ryken.cloud/js/popover.abe6a51cc7138c5dff00f151dd627ad1.min.js></script>
<script src=https://www.ryken.cloud/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://www.ryken.cloud/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://www.ryken.cloud/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const BASE_URL="https://www.ryken.cloud/",fetchData=Promise.all([fetch("https://www.ryken.cloud/indices/linkIndex.c83b530c16d6d7da0b36ea1cd7188b9b.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://www.ryken.cloud/indices/contentIndex.9060d617ba89eedd126cd276470515b4.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addCollapsibleCallouts(),initPopover("https://www.ryken.cloud",!0,!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!1;drawGraph("https://www.ryken.cloud",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})}</script><script>window.Million={navigate:e=>window.location.href=e,prefetch:()=>{}},window.addEventListener("DOMContentLoaded",()=>{init(),render()})</script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-11MD77L81V"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-11MD77L81V",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=search placeholder=支持标题及全文搜索...><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://www.ryken.cloud/js/full-text-search.24827f874defbbc6d529926cbfcfb493.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://www.ryken.cloud/>Knowledge Garden</a></h1><div class=spacer></div><div id=search-icon><p>search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>ipvs 相关的内核参数</h1><p class=meta>最近编辑于
Apr 15, 2024</p><ul class=tags></ul><aside class=mainTOC><details><summary>目录</summary><nav id=TableOfContents><ol><li><ol><li><a href=#1-参数-am_droprate>1. 参数 am_droprate</a></li><li><a href=#2-参数-amemthresh>2. 参数 amemthresh</a></li><li><a href=#3-参数-backup_only>3. 参数 backup_only</a></li><li><a href=#4-参数-conn_reuse_mode>4. 参数 conn_reuse_mode</a></li><li><a href=#5-参数-expire_nodest_conn>5. 参数 expire_nodest_conn</a></li><li><a href=#6-参数-expire_quiescent_template>6. 参数 expire_quiescent_template</a></li><li><a href=#7-参数-conntrack>7. 参数 conntrack</a></li></ol></li></ol></nav></details></aside><p>ipvs 相关内核文档：</p><ul><li><a href=https://docs.kernel.org/networking/ipvs-sysctl.html rel=noopener>IPvs-sysctl — The Linux Kernel documentation</a></li></ul><a href=#1-参数-am_droprate><h3 id=1-参数-am_droprate><span class=hanchor arialabel=Anchor># </span>1. 参数 am_droprate</h3></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>am_droprate - INTEGER
</span></span><span class=line><span class=cl>	default 10
</span></span><span class=line><span class=cl>	It sets the always mode drop rate, which is used in the mode 3 of the drop_rate defense.
</span></span></code></pre></td></tr></table></div></div><p>该参数是 ipvs 中 always 模式下丢包率的设置，它用于 drop_rate 防护机制的第三种模式。</p><ol><li>ipvs 中有一个叫 drop_rate 的防护机制，用于防止 DDoS 攻击。它有 3 种模式:<ul><li>模式1:当连接速率超过阈值时丢弃部分连接请求。</li><li>模式2:当连接速率超过阈值时丢弃所有连接请求。</li><li>模式3:始终以一定概率丢弃部分连接请求。</li></ul></li><li>am_droprate 就是用于模式3的丢包率设置。它是一个 0-100 的整数,表示以该概率丢弃连接请求。默认是 10。</li><li>通过设置一个较低的 am_droprate,可以在高负载情况下提前丢弃部分请求,从而保护后端真实服务器。</li><li>一般推荐设置为 10 左右。数值越高,丢包率越高,可保护性越强,但也会丢弃更多正常请求。需要根据实际情况调整。所以简单来说,am_droprate 是 ipvs 在 always 模式下用于防护的丢包率设置。它越高可保护性越强,但也会损失更多正常请求。需要合理设置该值。</li></ol><a href=#2-参数-amemthresh><h3 id=2-参数-amemthresh><span class=hanchor arialabel=Anchor># </span>2. 参数 amemthresh</h3></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>amemthresh - INTEGER
</span></span><span class=line><span class=cl>	default 1024
</span></span><span class=line><span class=cl>	It sets the available memory threshold (in pages), which is used in the automatic modes of defense. When there is no enough available memory, the respective strategy will be enabled and the variable is automatically set to 2, otherwise the strategy is disabled and the variable is set to 1.
</span></span></code></pre></td></tr></table></div></div><p>该参数是 ipvs 中自动防护模式下的可用内存阈值设置。其含义如下：</p><ol><li>ipvs 中的一些防护机制(如连接速率限制)可以工作在自动模式下。</li><li>在自动模式下,ipvs 会监控系统的可用内存。</li><li>当可用内存低于 amemthresh 设置的阈值时,相关的防护机制会被自动激活。此时 amemthresh 变量会被设置为2。</li><li>当可用内存高于阈值时,防护机制会自动停用。amemthresh 变量被设置为1。</li><li>amemthresh 的单位是页面数(page)。默认是1024，意思是当可用内存少于1024页时触发防护机制。</li><li>通过调整该值可以控制在什么内存使用情况下激活防护机制。数值越小,越容易激活防护;数值越大,需要内存使用越高才会防护。</li><li>一般推荐设置为物理内存的10%左右。
综上，amemthresh 是 ipvs 自动防护模式下的内存可用阈值设置。它控制了在什么内存使用情况下激活防护机制。</li></ol><a href=#3-参数-backup_only><h3 id=3-参数-backup_only><span class=hanchor arialabel=Anchor># </span>3. 参数 backup_only</h3></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>backup_only - BOOLEAN
</span></span><span class=line><span class=cl>	- 0 - disabled (default) 
</span></span><span class=line><span class=cl>	- not 0 - enabled
</span></span><span class=line><span class=cl>	If set, disable the director function while the server is in backup mode to avoid packet loops for DR/TUN methods.
</span></span></code></pre></td></tr></table></div></div><p>该参数用于控制 IPVS 在备份模式下的工作方式。其含义如下:</p><ol><li>在 IPVS 的主备模式下，主节点负责请求转发和负载均衡，备份节点处于待命状态。</li><li>对于 DR 和 TUN 两种工作方式，如果备份节点没有禁用负载均衡和转发功能，会导致请求在主备节点之间循环转发，形成包环路。</li><li>将 backup_only 设置为非零值(启用)后，当 IPVS 进入备份模式时，会自动禁用负载均衡和转发功能。</li><li>这样就避免了在主备模式下使用 DR 和 TUN 方式时可能出现的包环路问题。</li><li>默认设置为 0 (禁用)，即备份节点也会工作。</li></ol><p>所以，backup_only 参数控制了 IPVS 在备份模式下是否禁用负载均衡和转发功能。启用它可以避免 DR 和 TUN 模式在主备切换时产生的包环路问题，但备份节点不再参与负载分担，仅作为冷备用。需要根据实际需要设置。</p><a href=#4-参数-conn_reuse_mode><h3 id=4-参数-conn_reuse_mode><span class=hanchor arialabel=Anchor># </span>4. 参数 conn_reuse_mode</h3></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>conn_reuse_mode - INTEGER
</span></span><span class=line><span class=cl>	1 - default
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	Controls how ipvs will deal with connections that are detected port reuse. It is a bitmap, with the values being:
</span></span><span class=line><span class=cl>		0: disable any special handling on port reuse. The new connection will be delivered to the same real server that was servicing the previous connection.
</span></span><span class=line><span class=cl>		bit 1: enable rescheduling of new connections when it is safe. That is, whenever expire_nodest_conn and for TCP sockets, when the connection is in TIME_WAIT state (which is only possible if you use NAT mode).
</span></span><span class=line><span class=cl>		bit 2: it is bit 1 plus, for TCP connections, when connections are in FIN_WAIT state, as this is the last state seen by load balancer in Direct Routing mode. This bit helps on adding new real servers to a very busy cluster.
</span></span></code></pre></td></tr></table></div></div><p>该参数控制了 IPVS 在检测到端口复用时的处理方式，它是一个bitmap。具体含义如下：</p><ol><li>端口复用指客户端重新使用了之前已关闭连接的源端口发起新连接。</li><li>conn_reuse_mode 默认值为 1,表示启用安全的重调度机制。</li><li>设置位0：禁用任何端口复用的特殊处理。新连接会发送到之前为旧连接提供服务的同一真实服务器。</li><li>设置位1：在安全的情况下启用新连接的重调度。即当expire_nodest_conn设置生效时，以及对TCP连接，当连接处于TIME_WAIT状态时(仅NAT模式可用)。</li><li>设置位2：在位1的基础上,对TCP连接,当连接处于FIN_WAIT状态时也启用重调度。这在直接路由模式下添加新真实服务器到繁忙集群时很有帮助。</li><li>通过设置不同的位,可以控制在不同情况下是否重调度复用端口的新连接。综上，conn_reuse_mode控制复用端口连接的重调度策略，需要根据实际需求选择设置。</li></ol><a href=#5-参数-expire_nodest_conn><h3 id=5-参数-expire_nodest_conn><span class=hanchor arialabel=Anchor># </span>5. 参数 expire_nodest_conn</h3></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>expire_nodest_conn - BOOLEAN
</span></span><span class=line><span class=cl>	- 0 - disabled (default)
</span></span><span class=line><span class=cl>	- not 0 - enabled
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	The default value is 0, the load balancer will silently drop packets when its destination server is not available. It may be useful, when user-space monitoring program deletes the destination server (because of server overload or wrong detection) and add back the server later, and the connections to the server can continue.
</span></span><span class=line><span class=cl>	If this feature is enabled, the load balancer will expire the connection immediately when a packet arrives and its destination server is not available, then the client program will be notified that the connection is closed. This is equivalent to the feature some people requires to flush connections when its destination is not available
</span></span></code></pre></td></tr></table></div></div><p>该参数控制了当目标真实服务器不可用时，IPVS 如何处理连接的超时策略。含义如下:</p><ol><li>默认值为0,表示禁用该功能。当目标服务器不可用时,IPVS会静默丢弃报文。这在用户空间监控程序因服务器过载或错误检测而删除服务器,之后又添加回该服务器时很有用。连接可以继续,无需客户端重新建立。</li><li>如果将该参数设置为非0(启用)，则当一个报文到达而其目标服务器不可用时，IPVS会立即使该连接过期，客户端程序会收到连接已关闭的通知。该功能等效于在目标不可用时刷新连接的要求，</li><li>启用该功能时，无可用目标服务器会触发主动连接关闭。</li><li>禁用该功能时，连接静默过期，等待目标服务器恢复。</li><li>根据需要决定是立即通知客户端服务器不可用,还是静默等待服务器可用。</li></ol><p>总结一下，expire_nodest_conn控制目标服务器不可用时IPVS的连接处理策略。根据实际需求选择启用或禁用它</p><a href=#6-参数-expire_quiescent_template><h3 id=6-参数-expire_quiescent_template><span class=hanchor arialabel=Anchor># </span>6. 参数 expire_quiescent_template</h3></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>expire_quiescent_template - BOOLEAN
</span></span><span class=line><span class=cl>	- 0 - disabled (default)
</span></span><span class=line><span class=cl>	- not 0 - enabled
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	When set to a non-zero value, the load balancer will expire persistent templates when the destination server is quiescent. This may be useful, when a user makes a destination server quiescent by setting its weight to 0 and it is desired that subsequent otherwise persistent connections are sent to a different destination server. By default new persistent connections are allowed to quiescent destination servers.
</span></span><span class=line><span class=cl>	If this feature is enabled, the load balancer will expire the persistence template if it is to be used to schedule a new connection and the destination server is quiescent.
</span></span></code></pre></td></tr></table></div></div><p>该参数控制了目的地服务器处于静默状态(不再接受新的连接)时，IPVS 是否让持久连接模板过期的功能。其含义如下:</p><ol><li>默认值为 0，表示禁用该功能。</li><li>如果设置为非零值，则当目的地服务器进入静默状态(权重为0)时，IPVS 会让指向该服务器的持久连接模板过期。这在用户通过设置服务器权重为0使其进入静默状态,并希望后续的持久连接转发到其他服务器时很有用。</li><li>默认情况下,新的持久连接仍然允许转发到静默状态的服务器。如果启用该功能,当持久模板要用于转发新连接到静默状态服务器时,该模板会被移除。</li><li>该功能可以在需要将持久连接转移离开静默服务器时使用。</li></ol><p>总结一下,expire_quiescent_template 控制静默服务器的持久模板过期,用于将持久连接转移到其他服务器。</p><a href=#7-参数-conntrack><h3 id=7-参数-conntrack><span class=hanchor arialabel=Anchor># </span>7. 参数 conntrack</h3></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>conntrack - BOOLEAN
</span></span><span class=line><span class=cl>	- 0 - disabled (default)
</span></span><span class=line><span class=cl>	- not 0 - enabled
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	If set, maintain connection tracking entries for connections handled by IPVS.
</span></span><span class=line><span class=cl>	This should be enabled if connections handled by IPVS are to be also handled by stateful firewall rules. That is, iptables rules that make use of connection tracking. It is a performance optimisation to disable this setting otherwise.
</span></span><span class=line><span class=cl>	Connections handled by the IPVS FTP application module will have connection tracking entries regardless of this setting.
</span></span><span class=line><span class=cl>	Only available when IPVS is compiled with CONFIG_IP_VS_NFCT enabled.
</span></span></code></pre></td></tr></table></div></div><p>该参数控制着 IPVS 是否维护其处理的连接的连接跟踪表项。其含义如下:</p><ol><li>默认值为0，表示禁用该功能。</li><li>如果设置为非0，则IPVS会维护其处理的连接的连接跟踪(conntrack)表项。<ul><li>如果IPVS处理的连接也需要被状态防火墙规则处理,则需要启用该功能。比如基于连接跟踪的iptables规则。</li><li>如果连接不需要防火墙跟踪,则禁用该功能可以优化性能。</li><li>IPVS处理的FTP连接会无条件维护连接跟踪表项。</li><li>只有在IPVS编译时启用了CONFIG_IP_VS_NFCT配置时,该功能才可用。</li></ul></li></ol><p>conntrack控制IPVS维护连接跟踪以供防火墙使用。需要防火墙处理连接则启用,否则禁用可优化。所以,conntrack参数控制IPVS是否维护连接状态用于防火墙,根据需要决定启用或禁用。</p><p><img src=https://images.cherryfloris.eu.org/ryken/2023/09/fe510cb5e87550536b556fb0b2f8c42d.png width=auto alt=image.png></p><p><img src=https://images.cherryfloris.eu.org/ryken/2023/09/cf8019c10d531c7ac7f6884f384da655.png width=auto alt=image.png></p></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>反向链接</h3><ul class=backlinks><li>未发现反向链接</li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>内部链接关系图</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://www.ryken.cloud/js/graph.abd4bc2af3869a96524d7d23b76152c7.js></script></div></div><hr><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css><script src=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js></script><script src=alittlejs/md5.min.js></script><div id=gitalk-container></div><script>var gitalk=new Gitalk({clientID:"d21f4afcd185c95004e0",clientSecret:"8f1f442abf93a76461783af21c544717da9fc7b3",repo:"obsidian-publish",owner:"renyunkang",admin:["renyunkang"],id:location.href,distractionFreeMode:!1});gitalk.render("gitalk-container")</script><center><script>var caution=!1,now,visits;function setCookie(e,t,n,s,o,a){var i=e+"="+escape(t)+(n?"; expires="+n.toGMTString():"")+(s?"; path="+s:"")+(o?"; domain="+o:"")+(a?"; secure":"");!caution||(e+"="+escape(t)).length<=4e3?document.cookie=i:confirm("Cookie exceeds 4KB and will be cut!")&&(document.cookie=i)}function getCookie(s){var e=s+"=",n,t=document.cookie.indexOf(e);return t==-1?null:(n=document.cookie.indexOf(";",t+e.length),n==-1&&(n=document.cookie.length),unescape(document.cookie.substring(t+e.length,n)))}function deleteCookie(e,t,n){getCookie(e)&&(document.cookie=e+"="+(t?"; path="+t:"")+(n?"; domain="+n:"")+"; expires=Thu, 01-Jan-70 00:00:01 GMT")}function fixDate(e){var n=new Date(0),t=n.getTime();t>0&&e.setTime(e.getTime()-t)}now=new Date,fixDate(now),now.setTime(now.getTime()+730*24*60*60*1e3),visits=getCookie("counter"),visits?visits=parseInt(visits)+1:visits=1,setCookie("counter",visits,now),document.write("<font size=2>👋访问量："+visits+"")</script></center></div></body></html>